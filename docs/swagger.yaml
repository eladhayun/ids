definitions:
  handlers.JobStatus:
    properties:
      active:
        type: integer
      completion_time:
        type: string
      failed:
        type: integer
      job_name:
        type: string
      start_time:
        type: string
      status:
        type: string
      succeeded:
        type: integer
    type: object
  handlers.TriggerEmailImportRequest:
    properties:
      source:
        description: 'Optional: specific source/path in blob storage'
        type: string
    type: object
  handlers.TriggerEmailImportResponse:
    properties:
      error:
        type: string
      job_name:
        type: string
      message:
        type: string
      success:
        type: boolean
    type: object
  models.AnalyticsResponse:
    description: Analytics response payload
    properties:
      error:
        example: ""
        type: string
      success:
        example: true
        type: boolean
      summary:
        $ref: '#/definitions/models.AnalyticsSummary'
    type: object
  models.AnalyticsSummary:
    properties:
      email_embeddings_count:
        description: Emails processed for embeddings
        type: integer
      email_embeddings_ran:
        description: Whether email embeddings ran in period
        type: boolean
      email_threads:
        description: Total email threads
        type: integer
      end_date:
        description: Period end
        type: string
      openai_calls:
        description: Total OpenAI API calls
        type: integer
      openai_tokens_used:
        description: Total tokens consumed
        type: integer
      period:
        description: '"today", "yesterday", "last_7_days", "last_30_days"'
        type: string
      product_embeddings_count:
        description: Products processed for embeddings
        type: integer
      product_embeddings_ran:
        description: Embeddings info
        type: boolean
      product_suggestions:
        description: Total product suggestions made
        type: integer
      query_embeddings:
        description: Additional billing-relevant metrics
        type: integer
      sendgrid_emails_sent:
        description: Emails sent via SendGrid
        type: integer
      start_date:
        description: Period start
        type: string
      support_escalations:
        description: Support requests sent
        type: integer
      support_summarizations:
        description: GPT calls for support summaries (billable)
        type: integer
      support_summary_tokens:
        description: Tokens used for support summarizations
        type: integer
      thread_embeddings_count:
        description: Threads processed for embeddings
        type: integer
      total_conversations:
        description: Total chat conversations
        type: integer
      total_email_embeddings:
        description: Total email embeddings in DB
        type: integer
      total_emails:
        description: Total emails in database
        type: integer
      total_product_embeddings:
        description: Total product embeddings in DB
        type: integer
      unique_products_viewed:
        description: Unique products suggested
        type: integer
    type: object
  models.ChatRequest:
    description: Chat request payload
    properties:
      conversation:
        description: Array of conversation messages
        items:
          $ref: '#/definitions/models.ConversationMessage'
        type: array
    type: object
  models.ChatResponse:
    description: Chat response payload
    properties:
      error:
        description: Error message if any
        example: ""
        type: string
      products:
        additionalProperties:
          type: string
        description: Product name to SKU mapping for link generation
        type: object
      request_support:
        description: Whether to request customer email for support escalation
        example: false
        type: boolean
      response:
        description: AI response message
        example: Hello! How can I help you today?
        type: string
    type: object
  models.ConversationMessage:
    description: Single message in a conversation
    properties:
      message:
        description: Message content
        example: Hello, how can I help?
        type: string
      role:
        description: Message role (user, assistant, system)
        example: user
        type: string
    type: object
  models.DBHealthResponse:
    description: Database health check response
    properties:
      connected:
        description: Database connection status
        example: true
        type: boolean
      error:
        description: Error message if any
        example: ""
        type: string
      latency:
        description: Database ping latency
        example: 1ms
        type: string
      status:
        description: Health status
        example: healthy
        type: string
      timestamp:
        description: Timestamp of the check
        example: "2023-01-01T00:00:00Z"
        type: string
    type: object
  models.HealthResponse:
    description: Health check response
    properties:
      status:
        description: Health status
        example: healthy
        type: string
      timestamp:
        description: Timestamp of the check
        example: "2023-01-01T00:00:00Z"
        type: string
      version:
        description: Application version
        example: 1.0.0
        type: string
    type: object
  models.SupportRequest:
    description: Support escalation request payload
    properties:
      conversation:
        description: Full conversation history
        items:
          $ref: '#/definitions/models.ConversationMessage'
        type: array
      customer_email:
        description: Customer email address
        type: string
    type: object
  models.SupportResponse:
    description: Support escalation response payload
    properties:
      error:
        description: Error message if any
        example: ""
        type: string
      message:
        description: Response message
        example: Email sent successfully
        type: string
      success:
        description: Whether the email was sent successfully
        example: true
        type: boolean
    type: object
info:
  contact: {}
paths:
  /api/:
    get:
      consumes:
      - application/json
      description: Get basic service information
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Root endpoint
      tags:
      - general
  /api/admin/email-import-status/{jobName}:
    get:
      consumes:
      - application/json
      description: Gets the current status of an email import job
      parameters:
      - description: Job name
        in: path
        name: jobName
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.JobStatus'
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: Get email import job status
      tags:
      - admin
  /api/admin/import-emails:
    post:
      consumes:
      - application/json
      description: Triggers a Kubernetes Job that downloads emails from Azure Blob
        Storage, imports them into PostgreSQL, and generates embeddings (all in one
        job)
      parameters:
      - description: Import job parameters
        in: body
        name: request
        schema:
          $ref: '#/definitions/handlers.TriggerEmailImportRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/handlers.TriggerEmailImportResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/handlers.TriggerEmailImportResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/handlers.TriggerEmailImportResponse'
      summary: Trigger end-to-end email import
      tags:
      - admin
  /api/analytics:
    get:
      consumes:
      - application/json
      description: Get analytics summary for a specified time period (today, yesterday,
        last_7_days, last_30_days)
      parameters:
      - default: yesterday
        description: Time period (today, yesterday, last_7_days, last_30_days)
        in: query
        name: period
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.AnalyticsResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/models.AnalyticsResponse'
      summary: Get analytics summary
      tags:
      - analytics
  /api/analytics/daily-report:
    get:
      consumes:
      - application/json
      description: Get analytics report for the previous day, suitable for daily Slack
        notifications
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.AnalyticsResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/models.AnalyticsResponse'
      summary: Get daily analytics report
      tags:
      - analytics
  /api/chat:
    post:
      consumes:
      - application/json
      description: Send a conversation to the AI chatbot and get a response with product
        recommendations enhanced by similar past conversations
      parameters:
      - description: Chat request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.ChatRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.ChatResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/models.ChatResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/models.ChatResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/models.ChatResponse'
      summary: Chat with AI using enhanced vector search (products + email history)
      tags:
      - chat
  /api/chat/request-support:
    post:
      consumes:
      - application/json
      description: Escalate conversation to support team with customer email
      parameters:
      - description: Support request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/models.SupportRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.SupportResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/models.SupportResponse'
        "500":
          description: Internal Server Error
          schema:
            $ref: '#/definitions/models.SupportResponse'
      summary: Request support escalation
      tags:
      - support
  /api/healthz:
    get:
      consumes:
      - application/json
      description: Get basic health status of the application
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.HealthResponse'
      summary: Health check
      tags:
      - health
  /api/healthz/db:
    get:
      consumes:
      - application/json
      description: Get database connectivity status and latency
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/models.DBHealthResponse'
        "503":
          description: Service Unavailable
          schema:
            $ref: '#/definitions/models.DBHealthResponse'
      summary: Database health check
      tags:
      - health
swagger: "2.0"
